<!DOCTYPE html>
<html lang="en">
  
<head>


    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>

    <body>
        <nav class="navbar navbar-inverse navbar-fixed-top">
            
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">SkyTrends</a>
                </div>
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#"></a></li>
                </ul>
            </div>
        </nav>
            
        <div class="container" style="margin-top:50px">
            <section>
            <h1>Top Posts</h1>
            <h4><%- n_events %> events processed in <%- res_time %> ms</h4>
            </section>

            <div class="row">
                <div class="col-sm-8" style="background-color:rgb(255, 255, 255);">
                    
                    <% let i = 0; %>
                    <% posts.forEach(function(post_tier_data) { %>
                        
                        <div title="<%=JSON.stringify(post_data[i], null, '')%>" class="well">
                            <% let post = post_data[i]; %>

                            <% if(post){ %>
                                <div><%- post.did %></div>

                            <br>
                                <% if(post.embed && post.embed.images &&
                                 post.embed.images.length > 0 && 
                                 post.embed.images[0].alt == "" ){ %>
                                    <p>[Image]</p>
                                <% }else if(post.embed && post.embed.images && post.embed.images.length > 0 && post.embed.images[0].alt != ""){ %>
                                    <p>[Image Desc: <%- post.embed.images[0].alt %>]</p>
                                <% }else if(post.embed && post.embed.video){ %>
                                    [Video]
                                <% } %>

                                <div><%- post_data[i].text %></div>

                            <% } %>
             
                            <br>

                            <% let dateObj = new Date(post_tier_data.postedAt / 1000); %>
                            <% const zone = Intl.DateTimeFormat().resolvedOptions().timeZone %>
                            <%  let options = {
                                day: '2-digit',
                                month: '2-digit',
                                year: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit',
                                hour12: true,
                                timeZone: zone
                            };
                            %>
                            <% let formatter = new Intl.DateTimeFormat('en-US', options); %>
                            <% let utc = formatter.format(dateObj); %>

                            <div>Likes: <%- post_tier_data.likes %> Reposts: <%- post_tier_data.reposts %></div>
                            <div>Posted at: <%- utc %> - <%- zone %></div>
                            <div>
                                
                            Language: <%- post_data[i].langs %>

                            #<%- i+1 %>
                            <% if(post_tier_data.d_score > 0){ %>
                                ⬆️
                            <% }else{ %>
                                ⬇️
                            <% } %>
                            <a href="<%- post.post_url %>" target="_blank">Read original post</a>
                        
                            </div>

                            <% if(post_data[i].nsfw){ %>
                                NSFW❌
                            <% } %>

                        </div>
                        
                        <% i++; %>

                    <% }) %>

                </div>

                <div class="col-sm-4" style="background-color:rgb(255, 255, 255);">
                    
                    <div class="well">
                    
                        <p>test column two</p>
                    
                    </div>

                </div>

            </div>

        </div>
        
    </body>

</html>
